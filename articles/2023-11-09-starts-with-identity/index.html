<!doctype html>
<html lang="en-us">
  <head>
    <title>It starts with identity // Badasstronaut Solutions</title>
    <link rel="shortcut icon" href="/favicon.ico" />
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.120.4">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="Mickey" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="/css/main.min.6ff2c724358c5915e614ff98b6c2d4113eac50d423232db3c1141a73960f4426.css" />

    
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="It starts with identity"/>
<meta name="twitter:description" content="Serendipitously, or unfortunately depending on the day, my work has required deep experience with &ldquo;identity&rdquo; in software; this includes authentication and authorization. Identity modeling and implementation shows tremendous variety across organizations. While some best-practices do exist, even specification-driven engineering still leaves a surprising amount of ambiguity and inconsistency between implementations (vendor and internal).
Authentication is verifying who/what an entity is; a user, automated service, IoT device, etc.
This user is _authenticated_ by Google by virtue of their Google account This service is _authenticated_ based on client credentials (e."/>

    <meta property="og:title" content="It starts with identity" />
<meta property="og:description" content="Serendipitously, or unfortunately depending on the day, my work has required deep experience with &ldquo;identity&rdquo; in software; this includes authentication and authorization. Identity modeling and implementation shows tremendous variety across organizations. While some best-practices do exist, even specification-driven engineering still leaves a surprising amount of ambiguity and inconsistency between implementations (vendor and internal).
Authentication is verifying who/what an entity is; a user, automated service, IoT device, etc.
This user is _authenticated_ by Google by virtue of their Google account This service is _authenticated_ based on client credentials (e." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://badasstronaut.github.io/articles/2023-11-09-starts-with-identity/" /><meta property="article:section" content="articles" />
<meta property="article:published_time" content="2023-01-17T00:00:00+00:00" />
<meta property="article:modified_time" content="2023-01-17T00:00:00+00:00" />



  </head>
  <body>
    <header class="app-header">
      <a href="https://badasstronaut.github.io/"><img class="app-header-avatar" src="/icons/badasstronaut.svg" alt="Mickey" /></a>
      <span class="app-header-title">Badasstronaut Solutions</span>
      <nav class="app-header-menu">
          <a class="app-header-menu-item" href="/about-me">about me</a>
            |
          
          <a class="app-header-menu-item" href="/articles">articles</a>
            |
          
          <a class="app-header-menu-item" href="/resume">resume</a>
      </nav>
      <p>Mickey&#39;s personal site</p>
      <div class="app-header-social">
        
          <a href="https://www.linkedin.com/in/kylemickey/" target="_blank" rel="noreferrer noopener me">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-linkedin">
  <title>linkedin</title>
  <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle>
</svg>
          </a>
        
          <a href="https://github.com/badasstronaut" target="_blank" rel="noreferrer noopener me">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github">
  <title>github</title>
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
</svg>
          </a>
        
          <a href="mailto:kyle.mickey@gmail.com" target="_blank" rel="noreferrer noopener me">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-mail">
  <title>email</title>
  <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline>
</svg>
          </a>
        
      </div>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">It starts with identity</h1>
      <div class="post-meta">
        <div>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          Jan 17, 2023
        </div>
        <div>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          12 min read
        </div>
      </div>
    </header>
    <div class="post-content">
      <p>Serendipitously, or unfortunately depending on the day, my work has required deep experience with &ldquo;identity&rdquo; in software; this includes authentication and authorization. Identity modeling and implementation shows tremendous variety across organizations. While some best-practices do exist, even specification-driven engineering still leaves a surprising amount of ambiguity and inconsistency between implementations (vendor and internal).</p>
<blockquote>
<p><em>Authentication</em> is verifying <em>who/what</em> an entity is; a user, automated service, IoT device, etc.</p>
<blockquote>
<pre><code>This user is _authenticated_ by Google by virtue of their Google account  
This service is _authenticated_ based on client credentials (e.g. `client_id` and `client_secret`)  
</code></pre>
</blockquote>
</blockquote>
<blockquote>
<p><em>Authorization</em> verifies that an entity should be permitted access to a <em>Resource</em></p>
<blockquote>
<pre><code>The user is _authorized_ to access this endpoint because their JWT contains the `admin` role  
The service is _authorized_ to access this endpoint because it is in the `internal` network &lt;&lt;-- this is sub-optimal, but a common example  
</code></pre>
</blockquote>
</blockquote>
<p>My first toe into the waters of identity systems was at a small startup in the food/beverage space. At the time, they were using a homespun OAuth 1.0-inspired token exchange for web service/machine-to-machine flows. SAML and SSO were not yet on the radar for this company; user sessions were managed via the web framework used by engineering.</p>
<p>A while later, I was part of a team working configuring APIs via a 3rd-party Identity provider; we were just seeing microservice patterns gain adoption at enterprise scale. The system worked at a gateway level and became my first deep dive into OAuth2, OIDC, and SAML. As I moved through my career, identity kept coming up over and over again. I saw a <em>terrible</em> implementation at a startup, written in PHP. Essentially, a registration method set a user as <em>active,</em> <strong>then performed a database action</strong>, and unset-the activation on error&hellip; a crash or runtime error could result in an active user with no way to log in/re-register. Through happy circumstance, integrating systems has come up over and over (disclaimer: somehow or another, I have never had to work with LDAP or Active Directory); SSO and OIDC became familiar to me. I even designed a decoupled &ldquo;roles and permissions&rdquo; system for a large enterprise in the media industry. The POC informed a lot of my thinking about identity and access control. I spent a year administering internal tools for a large enterprise, where I learned about the challenges of managing cross-organizational access to shared systems. A surprising amount of toil keeps the wheels turning. One short-sighted leader asserted that it was &ldquo;cheaper&rdquo; to preserve the manual effort because of the time-to-payoff curve of automation (this was short-sighted because the assumption was a linear adoption curve, which was partially forced due to manual effort&hellip;).</p>
<p>Some of my deepest, and most interesting, identity work involved connected device certificates integrating via mutual TLS with a public key infrastructure (PKI) certificates. In the same role, I got to work with front-end bot control, as well as GDPR-compliant login systems. In all of these cases, no consistent identity model existed across the organization.</p>
<blockquote>
<p>The big picture: your identity system should proactively enable the organization to know configure, monitor, audit, and analyze: <em>&ldquo;Who did what and why?&rdquo;</em></p>
</blockquote>
<h2 id="were-using-_x_-so-were-good-right">We&rsquo;re using <em>x</em>, so we&rsquo;re good&hellip; right?</h2>
<p>Many medium-large orgs seem to decide on an identity provider, then have their services call endpoints hosted by that provider and feel like the identity implementation for their system is complete: &ldquo;We&rsquo;re using OAuth2.&rdquo; Only much later, when APIs are consuming APIs and crossing network/VPC boundaries across systems, does it become apparent how hard it is to track: <em>who has access to what, for what purpose?</em> Security audits come along, and it takes <em>weeks of effort</em> to catalog the various systems enforcing permissions and identity.</p>
<p>Why? For something as crucial to security and reliability, a cornerstone of trust for a company (encompassing end-users <em>and</em> machine/automation entities), why does identity present such a unique challenge? Why is it hard to get it right? Identity presents challenges at the social, organization, and technical levels. The concern cuts across software layers and networks, and yet the implementation of identity largely gets fractured among multiple teams in an organization. Let&rsquo;s be real: investing in identity is unrewarding. The best identity implementations are nearly transparent to users and organization.</p>
<p>Most identity solutions implemented by organizations are fine-tuned and tailored to the situation that led to their creation/implementation. Many enterprise-level auth solutions still seem geared towards servicing individual use cases, never making the transition from &ldquo;n of one&rdquo; to &ldquo;n of many.&rdquo; While OAuth2 and OIDC make <em>representing</em> identity, and configuring user log ins for a web app, rather easy, the challenge of dealing with identity still presents a lot of open questions. How should permissions be represented? How can we ensure JWT permissions get applied similarly per-service? How do roles and permissions get represented? Most vendors in the identity space have have implementations that differ from the use-case of the organization. Some edge case takes the &ldquo;vendor solution&rdquo; to another factor which needs to be engineered <em>around</em>! (Note: Vendor solutions are super useful and can save thousands of engineering hours, _but you still have to know what to use for which purpose, and which use-cases are not handled by vendors).</p>
<blockquote>
<p>Regardless of the vendors selected, identity design needs to occur at an organizational level, <em>especially where multiple services are involved</em></p>
</blockquote>
<h2 id="a-confounding-source-of-complexity">A confounding source of complexity</h2>
<p>&ldquo;Identity&rdquo; encompasses multiple concerns; this can be tricky because several of the concerns which <em>should</em> be managed by an identity system get adopted by other teams, usually in a tightly-scoped manner. For example, with GDPR and other privacy legislation initiatives either passing or in-the-works, a Data Privacy team often reviews architecture decisions and access patterns with multiple teams. Data access and authorization is often managed per-application; a database sometimes connects to multiple services which manage access independently! This can lead to a cross-system privilege escalation data access pattern. When dealing with internal and external access services, it&rsquo;s common to see issues with &ldquo;data chain-of-custody.&rdquo; A user uses an SSO session to access a front end (say a Single Page Application [SPA] for this example). The SPA sends a JWT to a back-end API. At this point in the service flow, <em>the original user who invoked the subsequent data request gets lost in a &ldquo;chain of custody.&rdquo;</em></p>
<p>Sure, this sort of issue can be engineered <em>around</em> by doing things like using &ldquo;on-behalf-of&rdquo; headers, but this is post-hoc handling. As the system grows and these sorts of edge cases increase, things start to get complex and convoluted. It gets harder and harder to reason about the system&hellip; <em>then</em>, if we want to have any observability &ndash; &ldquo;Who can do what, and <em>why?</em>&rdquo; &ndash; we need to write logging queries across multiple backend systems! This assumes that all traffic is following access patterns we anticipate. Anyone who has worked in any multi-service environment for long can tell you: This does not always hold true&hellip;</p>
<p>Unfortunately, these sorts of interdependent system issues are not something you can simply &ldquo;build yourself out of;&rdquo; the best-case scenarios are a patchwork of complex cross-system monitoring. This does not scale well, as every new service adds to the system complexity and this problem space grows. For organizations looking to capitalize on a connected ecosystem, a lack of cohesive, consistent identity modeling can impede these efforts.</p>
<p>By the way, does the organization have an inventory of all the actors, all of the actions, and all of the resources that might need to be protected at an organization?</p>
<h2 id="designing-identity">Designing Identity</h2>
<blockquote>
<p>To build connected ecosystems, identity should be represented in a sane, consistent, and scalable model</p>
</blockquote>
<p>Google and AWS have dedicated Identity and Access Management (IAM) services. This is because IAM is a cross-cutting concern. An identity system must encompass:</p>
<ul>
<li>Entities (users, services, devices, etc.)</li>
<li>Actions (CRUD + domain-specific)</li>
<li>Resources (data, endpoints, files&hellip; anything that should be controlled)</li>
</ul>
<p>The concepts of entities, actions, resources, etc. must be flexible! It does us no good to develop a system to manage the complexity of identity, only to discover that our system cannot represent some identities. An &ldquo;IoT Device&rdquo; is not a concept that we planned for when the many RFCs were written. A strong identity model should be extensible enough to encompass entity types and systems which don&rsquo;t exist yet.</p>
<p>At the time of this writing, authorization SaaS providers are in a nascent space. Authentication/OAuth providers are commonplace; authorization between apps and across services is often inconsistent or non-existent. Some schemes do not have dynamic data loading, others assume a <em>massive</em> flat-file of all entities/actors, etc. These limitations may presently need to be engineered around, but it&rsquo;s important to think of <em>vendor-provided tools as building bricks for your identity system</em>.</p>
<blockquote>
<p><em>Subject</em>, <em>Entity</em>, <em>Actor</em>: These are commonly-used terms referring to the agent which wants to perform an action in your service</p>
</blockquote>
<blockquote>
<p><em>Resource</em>: anything that you want to protect</p>
</blockquote>
<blockquote>
<p><em>Action</em>, <em>Permission</em>: Verbs; CRUD, but can also be specific to a domain (e.g. method-like names)</p>
</blockquote>
<p>Ideally, <em>any time a protected resource is accessed, an authorization check gets performed against an identity system</em>. This requires that an identity service be:</p>
<ul>
<li>reliable</li>
<li>performant</li>
<li>scalable</li>
</ul>
<p>All of the systems which manage protected resources need a way to verify permissions with an identity system. To reduce latency, keeping an identity system &ldquo;sidecar&rdquo; in your local compute environments may be a helpful approach. This can be a challenge for systems which are not &ldquo;cloud native&rdquo; or which are not containerized. When designing a system or choosing vendor components, it&rsquo;s important to have a general idea of your services and the access patterns they need to your identity system.</p>
<p>A comprehensive identity model needs to evaluate access patterns. <em>This gives us a chance to implement a &ldquo;zero trust&rdquo; identity system!</em></p>
<blockquote>
<p>&ldquo;Zero trust&rdquo; describes authenticating and authorizing requests regardless of their source; network access does not define permissions. This is a shift from the &ldquo;castle and moat&rdquo; approach to security, where a network perimeter is assumed to be secure and trusted. By designing your identity system with &ldquo;zero trust&rdquo; principals, you can keep your <em>systems</em> secure even if your <em>networks</em> are infiltrated.</p>
</blockquote>
<p>By designing an identity system which encompasses the access patterns, entity types, actions, and resources your organization requires, we gain consistency and scalability while preserving security and reliability. The focus shifts from &ldquo;How do we enforce authentication and authorization for this service?&rdquo; to &ldquo;What are our entities, actions, and resources for this service?&rdquo; By focusing on <em>how</em> your services fit into a model, you save a lot of duplicated effort across your organization.</p>
<blockquote>
<p><em>Role Based Access Control</em> (RBAC): A model for authorization which uses roles to determine access. Roles are collections of permissions. Many systems start with RBAC but end up having to manage a proliferation of roles.</p>
</blockquote>
<blockquote>
<p><em>Attribute Based Access Control</em> (ABAC): A model for authorization which uses attributes to determine access. Attributes may include metadata about the entity making the request <em>or</em> the resource being accessed. This enables applications to model access controls based on specific contexts</p>
</blockquote>
<blockquote>
<p><em>Relationship Based Access Control</em> (ReBAC): A model for authorization which uses relationships over hierarchies/deep nesting. This enables <em>deriving</em> access based on existing relational data. ReBAC powerfully captures logic such as &ldquo;The owner of this resource can perform these actions against resources organized <em>beneath</em> this resource.&rdquo;</p>
</blockquote>
<p>RBAC works well when there are defined actors and a discrete set of permissions in the system. ABAC sits decently well on top of RBAC. AWS uses ABAC in IAM/the Cedar policy engine, but also includes roles. ReBAC is used by Google and is reflected in GCP&rsquo;s IAM system. While it&rsquo;s useful to let your identity model be <em>informed</em> by public cloud implementations, it&rsquo;s also important that you don&rsquo;t solve problems you do not (and likely never will) have at your organization.</p>
<p>Before implementation, <em>harden</em> the identity model by gathering new use cases and attempt to model the use case in your system. This will help you identify use-cases that your model may not consider; it will also help with thinking about <em>extensibility</em>.</p>
<h2 id="observability">Observability</h2>
<p>Authorized transactions should be logged and monitored. Period. Well-designed software should have <em>no way to perform operations against protected data without logging.</em> The observability of the identity solution should be as thought-out as your entity, action, and resource modeling.</p>
<p>Since your identity solution will likely be used by multiple applications, you&rsquo;ll want to think about how you use your observability tools to answer the fundamental question, the reason for identity: &ldquo;What is being performed, by whom, against which resources, and why?&rdquo; <em>This is the central question to your identity system.</em></p>
<p><em>If you can prove that your identity system is applied consistently across your ecosystem, this simplifies your security audits.</em></p>
<h2 id="analytics">Analytics</h2>
<p>Most log ingestion and analysis systems have a time-limit; e.g. many vendor-provided systems use a 90-day retention policy. When working with identity data, you have a powerful tool for system-wide analytics. If you&rsquo;re billing per API call, you can use your identity system to assess which calls were performed. If you&rsquo;re on-boarding a new customer and want to see how often they are using your services, your identity system will help you answer the question. Proactively ensuring that your identity system outputs reliable data, consistently, will answer questions that you do not know you have yet. There will be <em>power</em> in this data that enables your organization to make better decisions.</p>
<h2 id="conclusion">Conclusion</h2>
<p>As an engineer who has worked in the identity space for a little while, across a handful of organizations, I have come to see identity as the entrypoint to a connected ecosystem. When no identity system exists, or the system is fractured and inconsistent, the organization incurs the complexity that comes from one-off integrations between each service; service-to-service calls can be brittle and difficult to reason about. As the number of entities and actors in a system increases, it takes longer and longer to securely build out new capacities.</p>
<p>On the other hand, a cohesive and consistent identity system can enable powerful, comprehensive benefits. The identity system becomes a shared protocol that all of your systems can reason about. The permissioning and entity language serves as a mini-domain-language for the actions of your services. The observability and visability you gain can be used to inform technical and product/financial decisions. You can even better understand the <em>costs</em> of your system when you are able to consistently track the entities, actions, and resources in your system.</p>

    </div>
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>
